// Generated by CoffeeScript 1.8.0
(function() {
  var commentTemplate, displayError, empty, getCsrfCookie, insertComment, rumble, saveComment;

  commentTemplate = '<div class="comment-box template" id="{{ comment.id }}" style="display: none;">' + '    <div class="comment-internals">' + '        <div>' + '            <p class="comment-author">author</p>' + '            <p class="comment-body">body</p>' + '        </div>' + '        <div>' + '            <p style="text-align: right">' + '                <a href="javascript:void(0)" class="reply">Reply</a>' + '            </p>' + '        </div>' + '    </div>' + '</div>';

  empty = function(x) {
    return x.val().length === 0;
  };

  rumble = function(element, amount) {
    if (amount === 0) {
      return;
    }
    element.css('position', 'relative');
    element.animate({
      'left': '1px'
    }, 50).animate({
      'left': '0px'
    }, 50);
    return rumble(element, amount - 1);
  };

  displayError = function(element) {
    element.css('border-color', '#F44336');
    return rumble(element, 4);
  };

  insertComment = function(element, data) {
    var commentBox, parent;
    parent = element.parents('.comment-box');
    commentBox = $($.parseHTML(commentTemplate));
    commentBox.attr('id', data.comment_id);
    commentBox.find('p.comment-author').text(data.name);
    commentBox.find('p.comment-body').text(data.body);
    commentBox.find('a.reply').hide();
    if (parent.length !== 0) {
      return parent.children('.comment-box:first').prepend(commentBox.html());
    } else {
      console.log("asdfasdf");
      return $('.root-comment').children('.comment-box:first').prepend(commentBox.html());
    }
  };

  saveComment = function(element) {
    var parent, parentId;
    parent = element.parents('.comment-box');
    if (parent.length === 0) {
      parentId = $('.root-comment .comment-box').attr('id');
    } else {
      parentId = parent.attr('id');
    }
    console.log('NAME: ' + element.next('.name-field').val());
    return new Promise(function(resolve, reject) {
      return $.ajax('./storecomment/', {
        type: 'POST',
        data: {
          'parent_id': parseInt(parentId),
          'body': element.parent().prev('textarea').val(),
          'name': element.next('.name-field').val()
        },
        xhrFields: {
          withCredentials: true
        }
      }).done(function(data) {
        console.log("sucess!");
        return resolve(data);
      }).fail(function(err) {
        return reject(err);
      });
    });
  };

  getCsrfCookie = function() {
    var cookie, _i, _len, _ref, _results;
    _ref = document.cookie.split(';');
    _results = [];
    for (_i = 0, _len = _ref.length; _i < _len; _i++) {
      cookie = _ref[_i];
      if (cookie.indexOf('csrftoken') > -1) {
        _results.push($.trim(cookie.split('=')[1]));
      }
    }
    return _results;
  };

  jQuery(function($) {
    var commentBox, defaultBorderColor, newComment;
    commentBox = $('.comment-field');
    newComment = $('.new-comment');
    defaultBorderColor = commentBox.css('border-color');
    console.log(defaultBorderColor);
    commentBox.on('click', function() {
      return $(this).animate({
        'height': '120px'
      }, 'slow').unbind().next('.comment-slider').slideDown();
    });
    $(document).on('click', '.comment-field, .name-field', function(evt) {
      return $(this).css('border-color', defaultBorderColor);
    });
    $(document).on('click', '.save-button', function(evt) {
      var comment, name;
      evt.preventDefault();
      comment = $(this).parent().prev('textarea');
      name = $(this).next('.name-field');
      console.log(comment.val().length === 0);
      console.log(name.val().length === 0);
      if (empty(comment)) {
        displayError(comment);
      }
      if (empty(name)) {
        displayError(name);
      }
      if (!empty(comment) && !empty(name)) {
        return saveComment($(this)).then((function(res) {
          $(evt.target).parents(".new-comment").slideUp();
          return insertComment($(evt.target), res);
        }), (function() {
          var error;
          error = $(evt.target).parents('div.comment-form').find('p.alert');
          error.css('display', 'block');
          return rumble(error, 2);
        }));
      }
    });
    return $('.comment-box .reply').on('click', function() {
      var child, parent, parentAuthor;
      parent = $(this).parents('.comment-internals');
      parentAuthor = parent.find('p.comment-author');
      child = newComment.clone();
      child.appendTo(parent);
      child.find('.comment-field, .name-field').css('border-color', defaultBorderColor);
      child.find('textarea').attr('placeholder', 'replying to ' + parentAuthor.text()).animate({
        'height': '120px'
      }, 'slow');
      child.find('.comment-slider').slideDown();
      return $(this).hide();
    });
  });

}).call(this);

//# sourceMappingURL=snake.js.map
